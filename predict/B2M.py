import numpy as np
import cv2
import math
import os
def isSqr(n):
    a = int(math.sqrt(n))
    if a*a == n:
        return True
    else:
        return False

def exe_to_pic(filedir, fname, todir):
    filename = os.path.join(filedir, fname)
    if not os.path.exists(filename):
        return "该文件不存在"
    f = open(filename, mode='rb')
    image = np.fromfile(f, dtype=np.ubyte)
    filesize = image.shape[0]
    #print(filesize)
    width = 0
    for i in range(filesize, 1, -1):
        if isSqr(i):
            #print(i)
            width = int(math.sqrt(i))
            break
    rem = filesize % width
    #print(rem)
    if rem != 0:
        image = image[:-rem]
    height = int(image.shape[0]/width)
    image = image.reshape(height,width)
    s = todir + '\\' + fname.split('.')[0] + '.jpg'
    cv2.imwrite(s, image)
    return fname.split('.')[0] + '.jpg'

# if __name__ == '__main__':
#     exe_to_pic('F:\\code_c++\\3.8\\bin\\Debug', '3.8.exe', './image')