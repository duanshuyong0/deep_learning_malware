import cv2 as cv
import os
import numpy as np
import sqrt_deal_pic as sp
import argparse

def cv_imread(filePath):
    cv_img = cv.imdecode(np.fromfile(filePath,dtype=np.uint8),-1)
    return cv_img

def deal_pic(filedir, fname, todir):
    img_file = os.path.join(filedir, fname)
    if not os.path.exists(img_file):
        return "文件不存在"
    img = cv_imread(img_file)
    # 将图片高和宽分别赋值给x，y
    x, y = img.shape[0:2]
    img = cv.resize(img, (800, 800))
    smap_norm = ((img - img.min()) / (img.max() - img.min())) * 255.0
    w_file = todir + "/" + fname
    cv.imwrite(w_file, smap_norm)
    return w_file
if __name__=='__main__':
    byte_dir = r'C:\Users\49627\Desktop\two_eight\test_file\bytes'
    dir = r'C:\Users\49627\Desktop\two_eight\test_file\pic'
    wdir = r'C:\Users\49627\Desktop\two_eight\test_file\deal_pic'
    parser = argparse.ArgumentParser(description='change to pic')
    parser.add_argument('--filedir', type=str, default=byte_dir)
    parser.add_argument('--todir', type=str, default=wdir)
    parser.add_argument('--fname', type=str, default='iwXK2bUysO0CPvBf8nTt.bytes')
    args = parser.parse_args()
    s = sp.change_to_pic(args.filedir, args.fname, dir)
    print(s)
    if 'jpg' in s:
        s = deal_pic(dir, s, wdir)
        print(s)